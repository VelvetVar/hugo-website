<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Step-by-step guide to deploying a Windows Server 2022 Domain Controller on Proxmox VE using VirtIO drivers.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/windows-ad/">
  <meta property="og:site_name" content="Rodrigo Martin">
  <meta property="og:title" content="Windows Server AD on Proxmox">
  <meta property="og:description" content="Step-by-step guide to deploying a Windows Server 2022 Domain Controller on Proxmox VE using VirtIO drivers.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">


  <meta itemprop="name" content="Windows Server AD on Proxmox">
  <meta itemprop="description" content="Step-by-step guide to deploying a Windows Server 2022 Domain Controller on Proxmox VE using VirtIO drivers.">
  <meta itemprop="wordCount" content="514">

<title>Windows Server AD on Proxmox | Rodrigo Martin</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/docs/windows-ad/">
<link rel="stylesheet" href="/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css" integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj&#43;RQ9XBXU=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.437b3b554622bfa301ec534b8f6878bbd402bb021d8b8598ab59e84a6fd232bb.js" integrity="sha256-Q3s7VUYiv6MB7FNLj2h4u9QCuwIdi4WYq1noSm/SMrs=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Rodrigo Martin</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a>
      Docs</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/cloud-infra/" class="">
      AWS Static Website</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cheatsheet/" class="">
      Commands: Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/homelab/" class="">
      Homelab Setup - Hardware Focus</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/homelab-services/" class="">
      Homelab Setup - Services Focus</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows-ad/" class="active">
      Windows Server AD on Proxmox</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Windows Server AD on Proxmox</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#phase-a-the-downloads">Phase A: The Downloads</a></li>
    <li><a href="#phase-b-virtual-machine-configuration">Phase B: Virtual Machine Configuration</a>
      <ul>
        <li><a href="#1-general--os">1. General &amp; OS</a></li>
        <li><a href="#2-system">2. System</a></li>
        <li><a href="#3-disks-storage">3. Disks (Storage)</a></li>
        <li><a href="#4-cpu--memory">4. CPU &amp; Memory</a></li>
        <li><a href="#5-network">5. Network</a></li>
      </ul>
    </li>
    <li><a href="#phase-c-the-two-cd-trick">Phase C: The &ldquo;Two-CD&rdquo; Trick</a></li>
    <li><a href="#phase-d-installation--driver-loading">Phase D: Installation &amp; Driver Loading</a></li>
    <li><a href="#phase-e-post-install-configuration">Phase E: Post-Install Configuration</a>
      <ul>
        <li><a href="#1-guest-tools">1. Guest Tools</a></li>
        <li><a href="#2-promote-to-domain-controller">2. Promote to Domain Controller</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="setting-up-windows-server-ad-on-proxmox">Setting up Windows Server AD on Proxmox<a class="anchor" href="#setting-up-windows-server-ad-on-proxmox">#</a></h1>
<p>Deploying Windows Server on Proxmox VE requires specific configuration to run efficiently. Windows does not natively support the Linux KVM virtualization architecture; therefore, <strong>VirtIO drivers</strong> must be injected during installation to ensure proper storage and network performance.</p>
<blockquote class='book-hint '>
<p><strong>Why VirtIO?</strong>
Without VirtIO drivers, Windows must use emulated IDE/SATA storage and Intel E1000 networking, which results in significant performance degradation. VirtIO allows the guest OS to &ldquo;speak&rdquo; directly to the hypervisor.</p>
</blockquote><h2 id="phase-a-the-downloads">Phase A: The Downloads<a class="anchor" href="#phase-a-the-downloads">#</a></h2>
<p>Before beginning the VM creation, ensure the following ISO files are uploaded to your Proxmox storage (<code>local</code> &gt; <strong>ISO Images</strong> &gt; <strong>Upload</strong>).</p>
<ol>
<li><strong>Windows Server 2022 Evaluation</strong>
<ul>
<li><strong>Source:</strong> <a href="https://www.microsoft.com/evalcenter/evaluate-windows-server-2022">Microsoft Evaluation Center</a></li>
<li><strong>Edition:</strong> 64-bit ISO.</li>
</ul>
</li>
<li><strong>VirtIO Driver ISO</strong>
<ul>
<li><strong>Source:</strong> <a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso">Fedora People (Stable)</a></li>
<li><strong>Contents:</strong> Required paravirtualized storage and network drivers.</li>
</ul>
</li>
</ol>
<h2 id="phase-b-virtual-machine-configuration">Phase B: Virtual Machine Configuration<a class="anchor" href="#phase-b-virtual-machine-configuration">#</a></h2>
<p>Use the following specifications to balance performance with resource conservation.</p>
<h3 id="1-general--os">1. General &amp; OS<a class="anchor" href="#1-general--os">#</a></h3>
<ul>
<li><strong>Name:</strong> <code>DC01</code> (Standard naming convention).</li>
<li><strong>Type:</strong> Microsoft Windows.</li>
<li><strong>Version:</strong> 11/2022.</li>
</ul>
<h3 id="2-system">2. System<a class="anchor" href="#2-system">#</a></h3>
<ul>
<li><strong>Graphics Card:</strong> <code>Default</code> or <code>SPICE</code> (SPICE offers smoother console performance).</li>
<li><strong>Qemu Agent:</strong> <code>Checked</code> (Crucial for IP reporting and graceful shutdowns).</li>
</ul>
<h3 id="3-disks-storage">3. Disks (Storage)<a class="anchor" href="#3-disks-storage">#</a></h3>
<ul>
<li><strong>Bus/Device:</strong> <code>SCSI</code> (Best performance).</li>
<li><strong>Storage:</strong> <code>local-lvm</code> (or preferred storage).</li>
<li><strong>Disk Size:</strong> <code>60 GB</code> (Min: 30GB for OS; 60GB allows for logs/updates).</li>
<li><strong>Cache:</strong> <code>Write back</code> (Safe for labs; improves speed).</li>
<li><strong>Discard:</strong> <code>Checked</code> (TRIM support to save SSD space).</li>
</ul>
<h3 id="4-cpu--memory">4. CPU &amp; Memory<a class="anchor" href="#4-cpu--memory">#</a></h3>
<ul>
<li><strong>Cores:</strong> <code>2</code> (DC tasks are generally low-load).</li>
<li><strong>Type:</strong> <code>Host</code> (Passes through host CPU features).</li>
<li><strong>Memory:</strong>
<ul>
<li><strong>Minimum:</strong> <code>2048 MB</code></li>
<li><strong>Recommended:</strong> <code>4096 MB</code> (Server Core) or <code>6144 MB</code> (Desktop Experience).</li>
</ul>
</li>
</ul>
<h3 id="5-network">5. Network<a class="anchor" href="#5-network">#</a></h3>
<ul>
<li><strong>Model:</strong> <code>VirtIO</code> (Paravirtualized).</li>
<li><strong>Warning:</strong> Do not use Intel E1000; VirtIO supports 10Gbps link speeds.</li>
</ul>
<h2 id="phase-c-the-two-cd-trick">Phase C: The &ldquo;Two-CD&rdquo; Trick<a class="anchor" href="#phase-c-the-two-cd-trick">#</a></h2>
<p>To install the OS on a SCSI drive, the installer requires access to the drivers simultaneously.</p>
<ol>
<li>Navigate to <strong>VM</strong> &gt; <strong>Hardware</strong>.</li>
<li>Verify the <strong>Windows ISO</strong> is attached to the primary CD drive.</li>
<li>Click <strong>Add</strong> &gt; <strong>CD/DVD Drive</strong>.</li>
<li>Select the <code>virtio-win.iso</code>.</li>
</ol>
<blockquote class='book-hint '>
<p><strong>Result:</strong> You must have <strong>two</strong> CD drives attached before booting: one containing the OS installer, and one containing the drivers.</p>
</blockquote><h2 id="phase-d-installation--driver-loading">Phase D: Installation &amp; Driver Loading<a class="anchor" href="#phase-d-installation--driver-loading">#</a></h2>
<ol>
<li>Start the VM and open the <strong>Console</strong>.</li>
<li>Select <strong>Windows Server 2022 Standard Desktop Experience</strong>.</li>
<li>Proceed to the screen: <strong>&ldquo;Where do you want to install Windows?&rdquo;</strong>
<ul>
<li><em>Note:</em> The list will be empty because Windows cannot see the SCSI drive yet.</li>
</ul>
</li>
<li>Click <strong>Load Driver</strong> &gt; <strong>Browse</strong>.</li>
<li>Navigate to the storage driver:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>CD Drive (VirtIO) &gt; vioscsi &gt; 2k22 &gt; amd64</span></span></code></pre></div></li>
<li>Click <strong>OK/Next</strong>. The 60GB drive will appear.</li>
</ol>
<blockquote class='book-hint '>
<p><strong>Pro Tip:</strong> You can repeat the &ldquo;Load Driver&rdquo; step now for the network driver to ensure connectivity immediately after boot. Navigate to: <code>NetKVM &gt; 2k22 &gt; amd64</code></p>
</blockquote><h2 id="phase-e-post-install-configuration">Phase E: Post-Install Configuration<a class="anchor" href="#phase-e-post-install-configuration">#</a></h2>
<h3 id="1-guest-tools">1. Guest Tools<a class="anchor" href="#1-guest-tools">#</a></h3>
<p>Once logged into Windows:</p>
<ol>
<li>Open <strong>File Explorer</strong>.</li>
<li>Open the <strong>VirtIO CD drive</strong>.</li>
<li>Run <code>virtio-win-guest-tools.exe</code>.</li>
<li><em>Result:</em> This installs the QEMU agent and fixes screen resolution and mouse latency.</li>
</ol>
<h3 id="2-promote-to-domain-controller">2. Promote to Domain Controller<a class="anchor" href="#2-promote-to-domain-controller">#</a></h3>
<ol>
<li>Open <strong>Server Manager</strong>.</li>
<li>Go to <strong>Manage</strong> &gt; <strong>Add Roles and Features</strong> &gt; <strong>Active Directory Domain Services</strong>.</li>
<li>Complete the installation.</li>
<li>Click the <strong>Yellow Flag</strong> notification icon in the top right.</li>
<li>Select <strong>Promote this server to a domain controller</strong>.</li>
<li>Select <strong>Add a new forest</strong> (e.g., <code>homelab.local</code> or <code>ad.yourname.com</code>).</li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>



  



  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/docs/homelab-services/" class="flex align-center">
        <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>Homelab Setup - Services Focus</span>
      </a>
    
    </span>
    <span>
    
    </span>
  </div>
  


 
        
  
  <div class="book-comments">

</div>
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#phase-a-the-downloads">Phase A: The Downloads</a></li>
    <li><a href="#phase-b-virtual-machine-configuration">Phase B: Virtual Machine Configuration</a>
      <ul>
        <li><a href="#1-general--os">1. General &amp; OS</a></li>
        <li><a href="#2-system">2. System</a></li>
        <li><a href="#3-disks-storage">3. Disks (Storage)</a></li>
        <li><a href="#4-cpu--memory">4. CPU &amp; Memory</a></li>
        <li><a href="#5-network">5. Network</a></li>
      </ul>
    </li>
    <li><a href="#phase-c-the-two-cd-trick">Phase C: The &ldquo;Two-CD&rdquo; Trick</a></li>
    <li><a href="#phase-d-installation--driver-loading">Phase D: Installation &amp; Driver Loading</a></li>
    <li><a href="#phase-e-post-install-configuration">Phase E: Post-Install Configuration</a>
      <ul>
        <li><a href="#1-guest-tools">1. Guest Tools</a></li>
        <li><a href="#2-promote-to-domain-controller">2. Promote to Domain Controller</a></li>
      </ul>
    </li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>





















---
title: "AWS Static Website"
description: "Technical documentation of the AWS, Cloudflare, and Hugo (Book) architecture."
weight: 10
draft: false
---

# Cloud Infrastructure

**Project Status:** Live Production
**Stack:** AWS (S3, CloudFront), Cloudflare, Hugo (Book Theme)
**Architecture:** Serverless Static Website

## 1. Architecture Overview

This project utilizes a **Serverless Static Website** architecture designed for high availability, security, and zero-maintenance scaling. The cost is negligible (Free Tier eligible) while offering enterprise-grade performance.



* **DNS:** **Cloudflare** (Manages DNS records and SSL Strict Mode).
* **CDN:** **AWS CloudFront** (Global caching, SSL termination, and Edge Logic).
* **Storage:** **AWS S3** (Private bucket, accessible *only* via CloudFront Origin Access Control).
* **Generator:** **Hugo + Book Theme** (Lightweight, no NPM dependencies).

---

## 2. Local Development Environment

To manage this site locally, the following software stack is required.

| Software | Version | Purpose |
| :--- | :--- | :--- |
| **Hugo** | Standard or Extended | Generates the static HTML site. |
| **AWS CLI** | v2.x | Synchronizes local build files to the S3 bucket. |
| **Git** | Latest | Version control and Theme Submodule management. |

### Critical Environment Variables (Windows)
The Windows `PATH` environment variable was updated to include:
* `C:\Hugo\bin\` (Containing `hugo.exe`)
* `C:\Program Files\Amazon\AWSCLIV2\`

*(Note: Node.js and NPM are no longer required).*

---

## 3. AWS Infrastructure Setup

### A. S3 Bucket (Storage)
1.  Created a bucket named `[DOMAIN]`.
2.  **Region:** `us-east-1` (N. Virginia).
3.  **Public Access:** Blocked *all* public access (Private).
4.  **Encryption:** Enabled (SSE-S3).

### B. Certificate Manager (SSL)
1.  Requested a public certificate in **us-east-1** for `[DOMAIN]` and `*.[DOMAIN]`.
2.  Validated ownership via DNS records in Cloudflare.

### C. CloudFront (CDN)
1.  **Origin:** Pointed to S3 Bucket.
2.  **Origin Access:** set to **Origin Access Control (OAC)** to secure the bucket.
3.  **Viewer Protocol:** Redirect HTTP to HTTPS.
4.  **Alternate Domain Name:** `[DOMAIN]`.
5.  **Custom SSL:** Attached the ACM Certificate created above.
6.  **Default Root Object:** Set to `index.html`.

### D. Edge Logic (The Sub-Directory Fix)
To prevent S3 "Access Denied" XML errors when visiting sub-pages (e.g., `/docs/`), a CloudFront Function was implemented on the **Viewer Request** behavior.

#### 1. Context and Problem Statement
When hosting static websites (generated by Hugo) on AWS S3, a common routing issue arises regarding "Pretty URLs."

* **The Hugo Output:** Hugo generates pages as directories containing an index file (e.g., `/docs/index.html`).
* **The Browser Request:** Users typically navigate to the directory root (e.g., `domain.com/docs/`).
* **The S3 Behavior:** S3 does not automatically serve `index.html` for sub-directories when accessed via CloudFront. Instead, it looks for an object named `docs/` (which does not exist), resulting in a **403 Access Denied** or **404 Not Found** XML error.

To resolve this, we implement a **CloudFront Function** at the edge to rewrite incoming requests before they reach the S3 origin.

#### 2. The Solution: `append-index-html`

**Type:** CloudFront Function (ECMAScript 5.1 compliant)
**Event Trigger:** Viewer Request
**Execution Location:** Edge Locations (Global)

#### The Script
```javascript
function handler(event) {
    var request = event.request;
    var uri = request.uri;

    // Logic 1: Handle Trailing Slashes
    // Example: /docs/ -> /docs/index.html
    if (uri.endsWith('/')) {
        request.uri += 'index.html';
    }
    // Logic 2: Handle "Clean" URLs (No Extension)
    // Example: /docs -> /docs/index.html
    else if (!uri.includes('.')) {
        request.uri += '/index.html';
    }

    return request;
}
```

### 3. Code Logic Analysis

The function operates on the `event` object passed by CloudFront. It modifies the `request.uri` property based on two specific conditions:



[Image of CloudFront function logic flow chart]


### Condition A: Trailing Slash Detection
```javascript
if (uri.endsWith('/')) { ... }
```
### Condition B: Extensionless (Clean) URL Detection
```javascript
else if (!uri.includes('.')) { ... }
```

---